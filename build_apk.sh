#!/bin/bash
# æ‰“åŒ… Android APK

echo "======================================================================="
echo "ğŸš€ æŠ¢å•åŠ©æ‰‹ - APK æ‰“åŒ…å·¥å…·"
echo "======================================================================="
echo ""

# æ£€æŸ¥ buildozer
if ! command -v buildozer &> /dev/null; then
    echo "âŒ buildozer æœªå®‰è£…"
    echo ""
    echo "å®‰è£…æ–¹æ³•ï¼š"
    echo "  pip install buildozer"
    echo "  pip install cython"
    echo ""
    exit 1
fi

# æ£€æŸ¥ä¾èµ–
echo "ğŸ“¦ æ£€æŸ¥ä¾èµ–..."
echo ""

# æ¸…ç†æ—§æ–‡ä»¶
if [ -d ".buildozer" ]; then
    echo "ğŸ—‘ï¸  æ¸…ç†æ—§çš„æ„å»ºæ–‡ä»¶..."
    rm -rf .buildozer
fi

if [ -d "bin" ]; then
    echo "ğŸ—‘ï¸  æ¸…ç†æ—§çš„APK..."
    rm -rf bin
fi

echo ""
echo "======================================================================="
echo "ğŸ”¨ å¼€å§‹æ„å»º APKï¼ˆé¦–æ¬¡æ„å»ºå¯èƒ½éœ€è¦30-60åˆ†é’Ÿï¼‰"
echo "======================================================================="
echo ""

# æ„å»º APK
buildozer -v android debug

echo ""
echo "======================================================================="
echo "âœ… æ„å»ºå®Œæˆï¼"
echo "======================================================================="
echo ""

if [ -f "bin/*.apk" ]; then
    echo "ğŸ“¦ APK æ–‡ä»¶ï¼š"
    ls -lh bin/*.apk
    echo ""
    echo "å®‰è£…æ–¹æ³•ï¼š"
    echo "  1. é€šè¿‡ USBï¼š"
    echo "     adb install bin/graborder-1.0.0-arm64-v8a-debug.apk"
    echo ""
    echo "  2. ç›´æ¥ä¼ è¾“åˆ°æ‰‹æœºå®‰è£…"
    echo ""
else
    echo "âŒ æ„å»ºå¤±è´¥ï¼Œè¯·æ£€æŸ¥é”™è¯¯ä¿¡æ¯"
fi

echo "======================================================================="

