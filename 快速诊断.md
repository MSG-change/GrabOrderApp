# Android 黑屏问题快速诊断

## 🚀 快速开始

### 步骤1: 连接设备

#### 如果是MuMu模拟器（端口5555）：

```bash
# 连接MuMu模拟器
adb connect 127.0.0.1:5555

# 验证连接
adb devices
# 应该看到: 127.0.0.1:5555    device
```

#### 如果是真实手机：

确保手机已通过USB连接，并开启USB调试。

### 步骤2: 查看日志

```bash
# 方法1: 使用提供的脚本（自动连接MuMu）
./view_android_logs.sh

# 方法2: 手动查看（MuMu模拟器）
adb -s 127.0.0.1:5555 logcat | grep -i "graborder\|python\|kivy\|error"

# 方法3: 手动查看（真实手机）
adb logcat | grep -i "graborder\|python\|kivy\|error"
```

### 步骤3: 查找关键错误

在日志中查找以下关键词：
- `❌` - 错误信息
- `Exception` - 异常堆栈
- `Traceback` - 错误追踪
- `字体加载失败` - 字体问题
- `UI构建失败` - UI问题

## 🔍 常见问题

### 问题1: 字体加载失败

**日志特征**：
```
⚠️ Android：未找到字体文件
```

**解决方法**：
1. 确认 `fonts/DroidSansFallback.ttf` 文件存在
2. 检查 `buildozer.spec` 中的 `source.include_exts` 包含 `ttf`
3. 重新构建APK

### 问题2: 模块导入失败

**日志特征**：
```
⚠️ VPN服务加载失败
⚠️ 抢单服务加载失败
```

**解决方法**：
1. 检查 `buildozer.spec` 中的 `requirements`
2. 确认所有Python文件路径正确
3. 检查模块导入语句

### 问题3: UI构建崩溃

**日志特征**：
```
❌ UI构建失败: ...
❌ MainScreen创建失败: ...
```

**解决方法**：
1. 查看完整错误堆栈
2. 检查是否有语法错误
3. 确认所有UI组件都能正常创建

### 问题4: MuMu模拟器连接失败

**症状**：
```
error: cannot connect to 127.0.0.1:5555
```

**解决方法**：
1. 确保MuMu模拟器已启动
2. 在MuMu设置中开启USB调试
3. 尝试重启MuMu模拟器
4. 检查端口是否正确（默认5555）

## 📝 修复内容

### 1. 字体加载优化
- ✅ Android环境下增强字体路径检测
- ✅ 添加多个可能的字体路径
- ✅ 字体加载失败时不影响应用启动

### 2. 错误处理增强
- ✅ 所有关键步骤都有错误处理
- ✅ 即使失败也能显示错误信息
- ✅ 详细的日志输出

### 3. 安全启动
- ✅ 即使所有模块失败，也能显示错误界面
- ✅ 不会因为单个模块失败而完全崩溃

### 4. MuMu模拟器支持
- ✅ 日志查看脚本自动连接MuMu模拟器
- ✅ 支持自定义MuMu端口
- ✅ 提供MuMu专用使用指南

## 🛠️ 下一步

1. **连接设备**：
   - MuMu: `adb connect 127.0.0.1:5555`
   - 手机: 通过USB连接
2. **查看日志**：运行 `./view_android_logs.sh`
3. **找到错误**：在日志中查找 `❌` 或 `Exception`
4. **修复问题**：根据错误信息修复
5. **重新构建**：修复后重新构建APK

## 📞 需要帮助？

如果问题仍然存在，请提供：
1. 完整的 logcat 日志（运行 `adb -s 127.0.0.1:5555 logcat > log.txt`）
2. 错误截图
3. buildozer.spec 配置

## ✅ 验证修复

修复后，日志应该显示：
```
✅ Android字体加载成功
✅ MainScreen创建完成
🎉 GrabOrderApp.build() 完成
```

如果看到这些信息，说明应用已成功启动！

## 📚 相关文档

- `MuMu模拟器使用指南.md` - MuMu模拟器详细使用指南
- `Android黑屏调试指南.md` - 详细的调试指南
- `view_android_logs.sh` - 日志查看脚本（支持MuMu）


